
<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;600&display=swap" rel="stylesheet">
   <title>وبلاگ وحید باقی</title>
   <style>
       body {
           font-family: Vazirmatn, sans-serif;
           line-height: 1.6;
           max-width: 900px;
           margin: 0 auto;
           padding: 20px;
           background-color: #f7f7f7;
       }

.notebook-container {
       background: white;
       border: 1px solid #e1e4e8;
       border-radius: 4px;
       box-shadow: 0 1px 3px rgba(0,0,0,0.12);
   }

   .header {
       padding: 20px;
       border-bottom: 1px solid #e1e4e8;
       background-color: #f6f8fa;
   }

   .post-title {
       font-size: 2em;
       margin: 0;
       color: #24292e;
   }

   .post-meta {
       color: #586069;
       font-size: 0.9em;
       margin-top: 10px;
   }

   .featured-image {
       width: 100%;
       max-height: 400px;
       object-fit: cover;
   }

   .content {
       padding: 20px;
   }

   .cell {
       margin: 20px 0;
       padding: 10px;
       border-radius: 3px;
       background-color: #f8f9fa;
       text-align: right;
   }

   code {
       background-color: #f6f8fa;
       padding: 2px 5px;
       border-radius: 3px;
       font-family: Monaco, Consolas, monospace;
   }

   .link-center {
       text-align: center;
   }
   
   
   .wp-block-image {
       text-align: center; 
   }

   .wp-block-image img {
       max-width: 100%; 
       height: auto; 
       display: block; 
       margin-left: auto;
       margin-right: auto;
   }
   .has-text-align-center{
    text-align: center;
   }
   
   .cell pre {
  word-break: break-all;
  overflow-wrap: break-word; 
  overflow-x: auto; 
}


 
   </style>
</head>
<body>
   <div class="notebook-container">
       <article class="main-article post-594 post type-post status-publish format-standard has-post-thumbnail hentry category-1 category-40">       
       <header class="header">
           <h1 class="post-title">باند های بازیگری در ۲۵۰ فیلم برتر IMDb</h1>
           <div class="post-meta">
               <span class="date">۱۴۰۱/۰۲/۰۴</span>
           </div>
       </header>

<section class="content">
           <div class="cell">
               <p>لبست ۲۵۰ فیلم برتر IMDb رو از طریق لینک زیر می‌تونید مشاهده کنید :</p>
           </div>
           <div class="cell">
            <pre class="has-text-align-center">https://www.imdb.com/chart/top/</pre>
           </div>
           <div class="cell">
               <p>مثلا من فیلم The Dark Knight رو باز می‌کنم :</p>
           </div>
           <div class="cell">
            <pre class="has-text-align-center">https://www.imdb.com/title/tt0468569/</pre>
           </div>
           <div class="cell">
               <p>تو صفحه هر فیلم یه سری اطلاعات از جمله نویسنده، کارگردان، بازیگران ستاره و … نوشته شده. اگر روی فلش مقابل Start (ستارگان فیلم) کلیک کنید :</p>
           </div>
           <div class="cell">
               <div class="wp-block-image">
                   <figure class="aligncenter"><img decoding="async" src="images/19-1.png" alt=""></figure>
               </div>
           </div>
           <div class="cell">
               <p>لینک زیر باز میشه و لیست کامل بازیگران و خدمه فیلم (صدابردار، جلوه های ویژه و …) رو نمایش میده :</p>
           </div>
           <div class="cell">
                <pre class="has-text-align-center">https://www.imdb.com/title/tt0468569/fullcredits?ref_=tt_ov_st_sm</pre>
            </div>
            <div class="cell">
               <div class="wp-block-image">
                   <figure class="aligncenter"><img decoding="async" src="images/19-2.png" alt=""><figcaption>https://www.imdb.com/title/tt0468569/fullcredits?ref_=tt_ov_st_sm</figcaption></figure>
               </div>
           </div>
           <div class="cell">
               <p>توی این صفحه اسم همه وجود داره. حتی اون سیاهی لشکری که یه لحظه از کنار خیابون رد شده! اما من اونها رو نمیخوام! فقط بازیگران اصلی رو میخوام. برای همین نام هایی که بعد Rest of cast listed alphabetically نوشته شده رو حذف خواهم کرد :</p>
            </div>
            <div class="cell">
                <div class="wp-block-image">
                    <figure class="aligncenter"><img decoding="async" src="images/19-3.png" alt=""></figure>
                </div>
            </div>
            <div class="cell">
               <hr class="wp-block-separator">
           </div>
           <div class="cell">
                <p>برخلاف مقالات قبلی که در ویرگول مینوشتم و خیلی بحث کدنویسی رو پیش نمی‌کشیدم، اینجا میخوام کد هایی که با استفاده از اونها این پروژه رو انجام دادم رو توضیح بدم. اولین کاری که باید انجام بدیم اینه که لیست ۲۵۰ فیلم برتر IMDb رو استخراج کنیم. روش اول استفاده از کتابخانه pandas است. خیلی ساده لینک صفحه ۲۵۰ فیلم برتر رو میدیم و جدولی که داخلش هست رو استخراج میکنه :اما مشکلی که این روش داره اینه که فقط محتویات ظاهری جدول رو استخراج میکنه :</p>
            </div>
            <div class="cell">
                <div class="wp-block-image">
                    <figure class="aligncenter"><img decoding="async" src="images/19-4.png" alt=""></figure>
                </div>
            </div>
            <div class="cell">
                <p>اما چیزی که من میخوام شناسه هر فیلمه. مثلا tt0068646 شناسه فیلم The Godfather است. با جایگزین کردنش با Movie_ID در لینک زیر میتونیم لیست کامل بازیگران و خدمه این فیلم رو ببینیم :</p>
            </div>
            <div class="cell">
                <pre class="has-text-align-center">https://www.imdb.com/title/&lt;Movie_ID&gt;/fullcredits?ref_=tt_ov_st_sm</pre>
            </div>
            <div class="cell">
                <p>اگر به ساختار کد های html صفحه ۲۵۰ فیلم برتر نگاه کنید می‌بینید که این Movie_ID در داخل href تگ a قرار داده شده :</p>
            </div>
            <div class="cell">
                <div class="wp-block-image">
                    <figure class="aligncenter"><img decoding="async" src="images/19-5.png" alt=""></figure>
                </div>
           </div>
           <div class="cell">
               <p>برای استخراج این ID ها از Regex استفاده کردم :اول اومدم کد html صفحه رو استخراج کردم. بعد یه Regex نوشتم که تمام string هایی که شامل عبارت زیر هستند رو در بیاره :</p>
            </div>
            <div class="cell">
                <pre class="has-text-align-center">href="/title/tt0111161/</pre>
           </div>
           <div class="cell">
                <p>متد findall همه string هایی که در این صفحه html وجود داره رو استخراج میکنه اما به جای اینکه ۲۵۰ تا باشه ۵۰۰ تاست! چرا؟ چون Movie_ID توی href تصویر فیلم هم وجود داره :</p>
           </div>
           <div class="cell">
                <div class="wp-block-image">
                    <figure class="aligncenter"><img decoding="async" src="images/19-6.png" alt=""></figure>
                </div>
           </div>
           <div class="cell">
                <p>به همین دلیل نتیجه رو داخل set قرار دادم که موارد تکراری رو حذف کنه. به این ترتیب ما موفق شدیم لیست ID فیلم های برتر رو استخراج کنیم :</p>
           </div>
           <div class="cell">
               <div class="wp-block-image">
                    <figure class="aligncenter"><img decoding="async" src="images/19-7.png" alt=""></figure>
               </div>
           </div>
           <div class="cell">
               <p>اما یک راه دیگه هم وجود داره. ما میتونیم از BeautifulSoup هم استفاده کنیم :اینجا من اول با استفاده از کتابخانه requests کد html صفحه رو استخراج کردم. بعد به عنوان ورودی به BeautifulSoup دادم. حالا چه جوری اطلاعات جدول رو استخراج کنیم؟ class این جدول برابر است با chart full-width :</p>
            </div>
            <div class="cell">
                <div class="wp-block-image">
                    <figure class="aligncenter"><img decoding="async" src="images/19-8.png" alt=""></figure>
                </div>
           </div>
           <div class="cell">
               <p>بعد از اینکه html جدول رو گرفتم، اومدم تمام tr ها رو استخراج کردم. tr ها در واقع سطر های این جدول ما هستند :</p>
            </div>
            <div class="cell">
                <div class="wp-block-image">
                    <figure class="aligncenter"><img decoding="async" src="images/19-9.png" alt=""></figure>
                </div>
           </div>
           <div class="cell">
               <p>حالا هر کدوم از این tr ها یکسری td داخلشون وجود داره. من کدوم رو میخوام؟ اونی که کلاس titleColumn است. چرا؟ چون Movie_ID داخل اینه. بعد href داخل تگ a رو میگیرم و ذخیره میکنیم :</p>
           </div>
           <div class="cell">
                <div class="wp-block-image">
                    <figure class="aligncenter"><img decoding="async" src="images/19-10.png" alt=""></figure>
                </div>
           </div>
           <div class="cell">
               <p>پس الان ما Movie_ID تمام این ۲۵۰ فیلم رو داریم!</p>
           </div>
            <div class="cell">
               <hr class="wp-block-separator">
            </div>
            <div class="cell">
               <p>حالا باید دونه دونه صفحه این فیلم ها رو باز کنیم و اسامی بازیگران رو استخراج کنیم. کدش به صورت زیر میشه :اینجا یه متد داریم به نام get_cast که url فیلم رو که به صورت زیره دریافت میکنه و لیست اسامی بازیگران رو برمیگردونه :</p>
            </div>
           <div class="cell">
                <pre class="has-text-align-center">https://www.imdb.com/title/tt0068646/fullcredits?ref_=tt_ov_st_sm</pre>
           </div>
           <div class="cell">
               <p>پایین تر یه حلقه for نوشتم که دونه دونه Movie_ID ها رو انتخاب میکنه و برای تابع get_cast میفرسته و نتیجه رو داخل یک دیکشنری به نام moive_cast ذخیره میکنه :</p>
            </div>
           <div class="cell">
                <div class="wp-block-image">
                    <figure class="aligncenter"><img decoding="async" src="images/19-11.png" alt=""></figure>
                </div>
           </div>
           <div class="cell">
               <p>هر سطر از این دیکشنری لیستی از بازیگران یک فیلم رو نگهداری میکنه. هر کدوم از این مقادیری که با nm شروع میشن شناسه یک بازیگر در سایت IMDb هستند :</p>
            </div>
            <div class="cell">
                 <pre class="has-text-align-center">https://www.imdb.com/name/nm0000008/?ref_=ttfc_fc_cl_t1</pre>
            </div>
            <div class="cell">
                <p>در مجموع شناسه ۹۶۶۹ بازیگر رو استخراج کردم.</p>
            </div>
            <div class="cell">
                <hr class="wp-block-separator">
            </div>
            <div class="cell">
                <p>برای اینکه این گراف با ۹۶۶۹ گره و ۶۷۷۲۶۲ یال (جهت دار) رو تحلیل کنم از <a href="https://blog.faradars.org/نمایش-ماتریسی-گراف/" rel="noreferrer noopener" target="_blank">ماتریس مجاورت</a> استفاده میکنم. در واقع این ماتریس ۹۶۶۹ سطر و ۹۶۶۹ ستون داره و هر کدوم از درایه های این ماتریس میتونن ۰ یا ۱ باشند. اگر ۱ باشند یعنی اون دو تا بازیگر با هم در یک فیلم بازی کردند. پس یه دیکشنری باید ایجاد کنم که شناسه بازیگران رو به ۰ تا ۹۶۶۸ نگاشت کنه :دیکشنری cast_to_index رو در ادامه استفاده میکنیم. مثلا برای اینکه شناسه بازیگر nm0890575 رو پیدا کنیم مینویسم :</p>
            </div>
            <div class="cell">
                <pre class="has-text-align-center">cast_to_index[nm0890575 ] ---&gt; 312</pre>
            </div>
            <div class="cell">
                <p>در نهایت با استفاده کد زیر ماتریس رو پر میکنیم :با استفاده از permutations میایم و تمام حالت های دو تایی که شناسه های داخل لیست میتونن داشته باشند رو در ماتریس مقداردهی میکنیم. مثلا اگر لیست زیر رو داشته باشیم :</p>
            </div>
            <div class="cell">
                 <pre class="has-text-align-center">['nm0000122', 'nm0001067', 'nm0588033']</pre>
            </div>
            <div class="cell">
                <p>تمام حالت های دو تایی به صورت زیر میشه :</p>
            </div>
            <div class="cell">
                 <pre class="has-text-align-center">('nm0000122', 'nm0001067')
('nm0000122', 'nm0588033')
('nm0001067', 'nm0000122')
('nm0001067', 'nm0588033')
('nm0588033', 'nm0000122')
('nm0588033', 'nm0001067')</pre>
            </div>
            <div class="cell">
               <p>این ماتریس خیییلی بزرگه! حجمی در حدود ۷۰۰ مگابایت داره. به همین دلیل اون رو به صورت sparce ذخیره میکنم :که حجمش چیزی در حدود ۱۵۰ کیلوبایت میشه و میتونید از لینک زیر دانلودش کنید :</p>
            </div>
           <div class="cell">
                 <pre class="has-text-align-center">https://storage.vahidbaghi.ir/sparse_matrix.npz</pre>
           </div>
           <div class="cell">
               <p>با استفاده از کد زیر هم میتونیم این ماتریس رو رسم کنیم :که نتیجه به صورت زیر میشه :</p>
           </div>
           <div class="cell">
                 <div class="wp-block-image">
                    <figure class="aligncenter"><img decoding="async" src="images/19-12.png" alt=""></figure>
                </div>
           </div>
           <div class="cell">
               <p>البته اگر در cast_to_index به جای اینکه index رو به صورت ترتیبی یکی یکی زیاد کنیم به صورت تصادفی مقداردهی میکردیم نتیجه به صورت زیر میشد : برای پیدا کردن community ها یا همون باند های بازیگری من از الگوریتم louvain استفاده کردم. برای آشنایی با این الگوریتم میتونید از منابع زیر استفاده کنید :</p>
           </div>
           <div class="cell">
                 <pre class="has-text-align-center">https://towardsdatascience.com/louvain-algorithm-93fde589f58chttps://www.youtube.com/watch?v=0zuiLBOIcsw</pre>
           </div>
           <div class="cell">
               <p>با استفاده کد زیر میتونیم به کمک الگوریتم louvain باند های بازیگری رو پیدا کنیم :که نتیجه به صورت زیر میشه :</p>
           </div>
           <div class="cell">
                 <div class="wp-block-image">
                    <figure class="aligncenter"><img decoding="async" src="images/19-13.png" alt=""></figure>
                </div>
           </div>
           <div class="cell">
               <p>لیست این community ها در louvain_comms نگهداری میشه :</p>
           </div>
           <div class="cell">
                <div class="wp-block-image">
                    <figure class="aligncenter"><img decoding="async" src="images/19-14.png" alt=""></figure>
                </div>
           </div>
           <div class="cell">
               <p>در مجموع ۶۵ باند بازیگری داریم. مثلا community یا باند اول ۲۵۹ عضو داره که بیشتر با هم فیلم بازی کردند. هر کدوم از مقادیر لیست های بالا هم همون اندیس سطر ماتریس ما هستند که با استفاده cast_to_index میتونیم بهشون دسترسی داشته باشیم.</p>
           </div>
       </section>
   </article>
   </div>
</body>
</html>


